<script setup lang="ts">
import type { Card } from '@fiction/site'
import type { UserConfig } from './index.js'
import { vue } from '@fiction/core'
import { useElementVisible } from '@fiction/ui/anim'
import EffectFitText from '@fiction/ui/effect/EffectFitText.vue'
import EffectGlare from '@fiction/ui/effect/EffectGlare.vue'
import XMedia from '@fiction/ui/media/XMedia.vue'
import CardText from '../CardText.vue'
import CardSocials from '../el/CardSocials.vue'
import NavDots from '../el/NavDots.vue'

const { card } = defineProps<{
  card: Card<UserConfig>
}>()

const uc = vue.computed(() => {
  return card.userConfig.value || {}
})

const mediaItems = vue.computed(() => {
  return uc.value.mediaItems?.filter(_ => _.media?.url)
})
const activeItem = vue.ref(0)
const isVisible = vue.ref(false)
vue.onMounted(async () => {
  await useElementVisible({ selector: `.minimal-profile`, onVisible: () => isVisible.value = true, caller: 'minimalProfile' })
})
</script>

<template>
  <div class="minimal-profile" :class="card.classes.value.contentWidth">
    <div>
      <div class="lg:flex gap-10 md:gap-12 xl:gap-24" :class="uc.layout === 'right' ? 'md:flex-row-reverse' : ''">
        <div class="w-full max-w-sm xl:max-w-full xl:w-[50%] mb-8 ">
          <div class="relative">
            <EffectGlare wrap-class="rounded-[20px]">
              <div class="aspect-[5/7] relative w-full overflow-x-auto snap-mandatory snap-x overscroll-none flex no-scrollbar clip-path-anim" :class="isVisible ? '[clip-path:inset(0_round_20px)] opacity-100' : '[clip-path:inset(30%)] opacity-50'">
                <XMedia v-for="(item, i) in mediaItems" :key="i" :media="item.media" class="relative slide w-full h-full snap-center shrink-0" />
              </div>
            </EffectGlare>
            <NavDots
              v-model:active-item="activeItem"
              :items="mediaItems || []"
              :container-id="card.cardId"
              class="absolute bottom-4 z-20 justify-center w-full"
              :overlay="true"
            />
          </div>
        </div>
        <div class="lg:w-[60%] xl:w-[50%] mt-6 md:mt-0 flex items-center">
          <div class="flex flex-col justify-center gap-10 2xl:gap-16 " :class="isVisible ? 'translate-y-0' : 'translate-y-[100px]'">
            <div class="details">
              <CardText
                tag="h3"
                :card
                class="text-primary-500 dark:text-primary-400 mb-4 xl:mb-6 text-base lg:text-xl font-sans font-medium"
                path="superTitle"
                animate="rise"
              />
              <EffectFitText
                tag="h1"
                :content="uc.title || ''"
                class="heading text-4xl font-semibold md:text-4xl lg:text-5xl x-font-title lg:leading-[1.2] "
                :lines="2"
                :min-size="40"
              >
                <CardText :card tag="span" path="title" animate="rise" />
              </EffectFitText>

              <CardText
                tag="div"
                :card
                class="sub-heading mt-6 prose prose-lg md:prose-2xl leading-normal dark:prose-invert prose-theme"
                path="content"
                animate="rise"
              />
            </div>

            <div class="list space-y-6 text-base xl:text-lg">
              <CardText
                tag="h3"
                :card
                class="sub-heading text-theme-300 dark:text-theme-600 x-font-sans font-semibold opacity-80"
                path="detailsTitle"
                placeholder="List Title"
              />
              <div class="flex gap-[10%] gap-y-4 flex-wrap font-sans font-medium">
                <div v-for="(item, i) in uc.details" :key="i" class="w-full md:w-[45%] ">
                  <CardText
                    :card
                    class="font-semibold"
                    :path="`details.${i}.name`"
                  />
                  <CardText
                    tag="a"
                    :card
                    :class="item.href ? 'hover:opacity-80 text-primary-600 dark:text-primary-400' : 'text-theme-500 dark:text-theme-400'"
                    :path="`details.${i}.desc`"
                    :href="item.href"
                  />
                </div>
              </div>
            </div>

            <CardSocials :card :socials="uc.socials || []" class="flex gap-2 text-2xl justify-center md:justify-start" />
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<style lang="less">
.clip-path-anim{
  // '0.25,1,0.5,1'
  transition: clip-path 2s cubic-bezier(0.25, 1, 0.33, 1), opacity 2s cubic-bezier(0.25, 1, 0.33, 1), transform 2s cubic-bezier(0.25, 1, 0.33, 1);
}
</style>
